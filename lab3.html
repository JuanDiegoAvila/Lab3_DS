<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>lab3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="lab3_files/libs/clipboard/clipboard.min.js"></script>
<script src="lab3_files/libs/quarto-html/quarto.js"></script>
<script src="lab3_files/libs/quarto-html/popper.min.js"></script>
<script src="lab3_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="lab3_files/libs/quarto-html/anchor.min.js"></script>
<link href="lab3_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="lab3_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="lab3_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="lab3_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="lab3_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<section id="laboratorio-3---data-science" class="level1">
<h1>Laboratorio 3 - Data Science</h1>
<p>Integrantes:</p>
<ul>
<li>Juan Diego Avila 20090</li>
<li>Diego Franco 20240</li>
</ul>
<section id="ejercicio-1" class="level2">
<h2 class="anchored" data-anchor-id="ejercicio-1">Ejercicio 1</h2>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.utils <span class="im">import</span> to_categorical</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neural_network <span class="im">import</span> MLPClassifier</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, GridSearchCV, RandomizedSearchCV</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> pd.read_csv(<span class="st">'./data/test.csv'</span>, delimiter<span class="op">=</span><span class="st">','</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> pd.read_csv(<span class="st">'./data/train.csv'</span>, delimiter<span class="op">=</span><span class="st">','</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> train.drop(columns<span class="op">=</span><span class="st">'label'</span>).values</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> train[<span class="st">'label'</span>].values</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="analisis-exploratorio" class="level3">
<h3 class="anchored" data-anchor-id="analisis-exploratorio">Analisis exploratorio</h3>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(train.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(42000, 785)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ver si hay nan</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(train.isnull().<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>label       0
pixel0      0
pixel1      0
pixel2      0
pixel3      0
           ..
pixel779    0
pixel780    0
pixel781    0
pixel782    0
pixel783    0
Length: 785, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="bu">dict</span> <span class="op">=</span> {}</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> train[<span class="st">'label'</span>]:</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="kw">in</span> <span class="bu">dict</span>:</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">dict</span>[i] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">dict</span>[i] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>plt.bar(<span class="bu">dict</span>.keys(), <span class="bu">dict</span>.values(), color<span class="op">=</span><span class="st">'g'</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Label'</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Count'</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lab3_files/figure-html/cell-5-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Se puede ver que esta balanceada la cantidad de datos de cada clase, por lo que no es necesario hacer un balanceo de datos.</p>
</section>
<section id="red-neuronal-simple" class="level3">
<h3 class="anchored" data-anchor-id="red-neuronal-simple">Red neuronal simple</h3>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'hidden_layer_sizes'</span>: [(<span class="dv">50</span>,), (<span class="dv">100</span>,), (<span class="dv">50</span>, <span class="dv">50</span>)]</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> MLPClassifier(max_iter<span class="op">=</span><span class="dv">1000</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>grid_search <span class="op">=</span> GridSearchCV(model, param_grid, cv<span class="op">=</span><span class="dv">3</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>grid_search.fit(X_train, y_train)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>best_params <span class="op">=</span> grid_search.best_params_</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>best_model <span class="op">=</span> grid_search.best_estimator_</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Mejores hiperparámetros:"</span>, best_params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mejores hiperparámetros: {'hidden_layer_sizes': (50, 50)}</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> best_model.predict(X_test)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Accuracy: '</span>, accuracy_score(y_test, y_pred))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear una matriz de confusión</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="op">=</span> confusion_matrix(y_test, y_pred)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar la matriz de confusión utilizando seaborn</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">7</span>))</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>sns.heatmap(conf_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">"d"</span>, cmap<span class="op">=</span><span class="st">"Blues"</span>, cbar<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Predicted"</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Actual"</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Matriz de Confusión"</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy:  0.9530952380952381</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="lab3_files/figure-html/cell-7-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Como se puede ver el modelo utilizando hidden_layer_sizes = (50,50) tiene un buen accuracy con 0.95. La matriz de confusion muestra que el modelo predice bien en casi todos los casos, pero se equivoca mas prediciendo el 7, 8 y 3.</p>
</section>
<section id="deep-learning" class="level3">
<h3 class="anchored" data-anchor-id="deep-learning">Deep Learning</h3>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, GridSearchCV</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.models <span class="im">import</span> Sequential</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Conv2D, MaxPooling2D, Flatten, Dense, Dropout</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.wrappers.scikit_learn <span class="im">import</span> KerasClassifier</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.utils <span class="im">import</span> to_categorical</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">28</span>, <span class="dv">28</span>, <span class="dv">1</span>) </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>y_one_hot <span class="op">=</span> to_categorical(y, num_classes<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y_one_hot, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_model(dropout_rate<span class="op">=</span><span class="fl">0.5</span>):</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> Sequential([</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>        Conv2D(<span class="dv">32</span>, kernel_size<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">3</span>), activation<span class="op">=</span><span class="st">'relu'</span>, input_shape<span class="op">=</span>(<span class="dv">28</span>, <span class="dv">28</span>, <span class="dv">1</span>)),</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>        MaxPooling2D(pool_size<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">2</span>)),</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>        Conv2D(<span class="dv">64</span>, kernel_size<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">3</span>), activation<span class="op">=</span><span class="st">'relu'</span>),</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>        MaxPooling2D(pool_size<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">2</span>)),</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>        Flatten(),</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>        Dense(<span class="dv">128</span>, activation<span class="op">=</span><span class="st">'relu'</span>),</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>        Dropout(dropout_rate), </span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>        Dense(<span class="dv">10</span>, activation<span class="op">=</span><span class="st">'softmax'</span>)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">compile</span>(optimizer<span class="op">=</span><span class="st">'adam'</span>, loss<span class="op">=</span><span class="st">'categorical_crossentropy'</span>, metrics<span class="op">=</span>[<span class="st">'accuracy'</span>])</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> KerasClassifier(build_fn<span class="op">=</span>create_model, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">'batch_size'</span>: [<span class="dv">32</span>, <span class="dv">64</span>],</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">'epochs'</span>: [<span class="dv">10</span>, <span class="dv">20</span>]</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> GridSearchCV(estimator<span class="op">=</span>model, param_grid<span class="op">=</span>param_grid, n_jobs<span class="op">=-</span><span class="dv">1</span>, cv<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> grid.fit(X_train, y_train)</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Mejor: </span><span class="sc">%f</span><span class="st"> usando </span><span class="sc">%s</span><span class="st">"</span> <span class="op">%</span> (grid_result.best_score_, grid_result.best_params_))</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>best_model <span class="op">=</span> grid_result.best_estimator_</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>test_loss, test_accuracy <span class="op">=</span> best_model.model.evaluate(X_test, y_test)</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Precisión en el conjunto de prueba:"</span>, test_accuracy)</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\Juan_Avila\AppData\Local\Temp\ipykernel_26528\3411349165.py:35: DeprecationWarning: KerasClassifier is deprecated, use Sci-Keras (https://github.com/adriangb/scikeras) instead. See https://www.adriangb.com/scikeras/stable/migration.html for help migrating.
  model = KerasClassifier(build_fn=create_model, verbose=0)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Mejor: 0.983542 usando {'batch_size': 64, 'epochs': 20}
263/263 [==============================] - 4s 13ms/step - loss: 0.0596 - accuracy: 0.9874
Precisión en el conjunto de prueba: 0.9873809814453125</code></pre>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> multilabel_confusion_matrix, classification_report</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Predecir las etiquetas en el conjunto de prueba</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> best_model.predict(X_test)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir y_test de indicador multiclase a etiquetas enteras</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>y_test_classes <span class="op">=</span> np.argmax(y_test, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular la matriz de confusión</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>confusion <span class="op">=</span> confusion_matrix(y_test_classes, y_pred)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear una figura y un eje</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(font_scale<span class="op">=</span><span class="fl">1.2</span>)  <span class="co"># Escala de fuente para una mejor legibilidad</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear el mapa de calor de la matriz de confusión</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>sns.heatmap(confusion, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">"d"</span>, cmap<span class="op">=</span><span class="st">"Blues"</span>)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Predicted"</span>)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Actual"</span>)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Matriz de Confusión"</span>)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>263/263 [==============================] - 3s 12ms/step</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="lab3_files/figure-html/cell-9-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Como se puede observar el mejor modelo fue utilizando el batch_size de 64, con 20 epocas teniendo un accuracy de casi 0.99 por lo que se puede decir que el modelo es muy bueno. En la matriz de confusion se peude observar que se equivoca en muy pocas ocasiones, por lo que se puede decir que el modelo es muy bueno.</p>
</section>
<section id="otro-algoritmo" class="level3">
<h3 class="anchored" data-anchor-id="otro-algoritmo">Otro algoritmo</h3>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'n_estimators'</span>: [<span class="dv">50</span>, <span class="dv">100</span>],</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'max_depth'</span>: [<span class="va">None</span>, <span class="dv">10</span>],</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'min_samples_split'</span>: [<span class="dv">2</span>, <span class="dv">5</span>],</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'min_samples_leaf'</span>: [<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> RandomForestClassifier(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>grid_search <span class="op">=</span> GridSearchCV(model, param_grid, cv<span class="op">=</span><span class="dv">3</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>grid_search.fit(X_train, y_train)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>best_model <span class="op">=</span> grid_search.best_estimator_</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>best_params <span class="op">=</span> grid_search.best_params_</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Mejores hiperparámetros:"</span>, best_params)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>y_pred_best <span class="op">=</span> best_model.predict(X_test)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>accuracy_best <span class="op">=</span> accuracy_score(y_test, y_pred_best)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Best Model Accuracy:'</span>, accuracy_best)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>conf_matrix_best <span class="op">=</span> confusion_matrix(y_test, y_pred_best)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">7</span>))</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>sns.heatmap(conf_matrix_best, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">"d"</span>, cmap<span class="op">=</span><span class="st">"Blues"</span>, cbar<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Predicted"</span>)</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Actual"</span>)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Mejor Modelo (Random Forest) - Matriz de Confusión"</span>)</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mejores hiperparámetros: {'max_depth': None, 'min_samples_leaf': 1, 'min_samples_split': 5, 'n_estimators': 100}
Best Model Accuracy: 0.9614285714285714</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="lab3_files/figure-html/cell-10-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Como se puede ver el modelo utilizando ‘max_depth’: None, ‘min_samples_leaf’: 1, ‘min_samples_split’: 5, ‘n_estimators’: 100, tiene un buen accuracy con 0.96. La matriz de confusion muestra que el modelo predice bien en casi todos los casos, pero se equivoca mas prediciendo el 9, 4.</p>
</section>
<section id="prueba-con-mejor-modelo" class="level3">
<h3 class="anchored" data-anchor-id="prueba-con-mejor-modelo">Prueba con mejor modelo</h3>
<p>En nuestro caso el mejor modelo fue el de Deep Learning, por lo que se procede a realizar la prueba con este modelo.</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, GridSearchCV</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.models <span class="im">import</span> Sequential</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Conv2D, MaxPooling2D, Flatten, Dense, Dropout</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.wrappers.scikit_learn <span class="im">import</span> KerasClassifier</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.utils <span class="im">import</span> to_categorical</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar y preparar tus datos, como se muestra en tu código original</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir una función para crear el modelo CNN</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_model(dropout_rate<span class="op">=</span><span class="fl">0.5</span>):</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> Sequential([</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>        Conv2D(<span class="dv">32</span>, kernel_size<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">3</span>), activation<span class="op">=</span><span class="st">'relu'</span>, input_shape<span class="op">=</span>(<span class="dv">28</span>, <span class="dv">28</span>, <span class="dv">1</span>)),</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>        MaxPooling2D(pool_size<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">2</span>)),</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>        Conv2D(<span class="dv">64</span>, kernel_size<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">3</span>), activation<span class="op">=</span><span class="st">'relu'</span>),</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>        MaxPooling2D(pool_size<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">2</span>)),</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>        Flatten(),</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>        Dense(<span class="dv">128</span>, activation<span class="op">=</span><span class="st">'relu'</span>),</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>        Dropout(dropout_rate),  <span class="co"># Para evitar el sobreajuste</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>        Dense(<span class="dv">10</span>, activation<span class="op">=</span><span class="st">'softmax'</span>)</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">compile</span>(optimizer<span class="op">=</span><span class="st">'adam'</span>, loss<span class="op">=</span><span class="st">'categorical_crossentropy'</span>, metrics<span class="op">=</span>[<span class="st">'accuracy'</span>])</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Entrenar el modelo con los mejores parámetros encontrados</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>best_model <span class="op">=</span> create_model(dropout_rate<span class="op">=</span><span class="fl">0.5</span>)  <span class="co"># Agrega el dropout_rate adecuado</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>best_model.fit(X_train, y_train, batch_size<span class="op">=</span><span class="dv">64</span>, epochs<span class="op">=</span><span class="dv">20</span>, verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluar en el conjunto de prueba</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>test_loss, test_accuracy <span class="op">=</span> best_model.evaluate(X_test, y_test)</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Precisión en el conjunto de prueba:"</span>, test_accuracy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 1/20
525/525 [==============================] - 40s 72ms/step - loss: 0.7565 - accuracy: 0.8492
Epoch 2/20
525/525 [==============================] - 53s 101ms/step - loss: 0.1734 - accuracy: 0.9482
Epoch 3/20
525/525 [==============================] - 56s 106ms/step - loss: 0.1196 - accuracy: 0.9636
Epoch 4/20
525/525 [==============================] - 47s 89ms/step - loss: 0.0977 - accuracy: 0.9717
Epoch 5/20
525/525 [==============================] - 37s 70ms/step - loss: 0.0869 - accuracy: 0.9748
Epoch 6/20
525/525 [==============================] - 38s 72ms/step - loss: 0.0743 - accuracy: 0.9784
Epoch 7/20
525/525 [==============================] - 39s 74ms/step - loss: 0.0750 - accuracy: 0.9781
Epoch 8/20
525/525 [==============================] - 38s 72ms/step - loss: 0.0640 - accuracy: 0.9810
Epoch 9/20
525/525 [==============================] - 36s 68ms/step - loss: 0.0584 - accuracy: 0.9819
Epoch 10/20
525/525 [==============================] - 35s 66ms/step - loss: 0.0558 - accuracy: 0.9826
Epoch 11/20
525/525 [==============================] - 32s 62ms/step - loss: 0.0524 - accuracy: 0.9841
Epoch 12/20
525/525 [==============================] - 52s 99ms/step - loss: 0.0470 - accuracy: 0.9861
Epoch 13/20
525/525 [==============================] - 35s 67ms/step - loss: 0.0497 - accuracy: 0.9848
Epoch 14/20
525/525 [==============================] - 32s 61ms/step - loss: 0.0461 - accuracy: 0.9856
Epoch 15/20
525/525 [==============================] - 43s 82ms/step - loss: 0.0436 - accuracy: 0.9876
Epoch 16/20
525/525 [==============================] - 44s 84ms/step - loss: 0.0382 - accuracy: 0.9882
Epoch 17/20
525/525 [==============================] - 38s 72ms/step - loss: 0.0383 - accuracy: 0.9886
Epoch 18/20
525/525 [==============================] - 41s 77ms/step - loss: 0.0417 - accuracy: 0.9875
Epoch 19/20
525/525 [==============================] - 39s 74ms/step - loss: 0.0365 - accuracy: 0.9889
Epoch 20/20
525/525 [==============================] - 32s 61ms/step - loss: 0.0347 - accuracy: 0.9894
263/263 [==============================] - 4s 13ms/step - loss: 0.0556 - accuracy: 0.9887
Precisión en el conjunto de prueba: 0.9886904954910278</code></pre>
</div>
</div>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>images <span class="op">=</span> [<span class="st">'dos.png'</span>, <span class="st">'cuatro.png'</span>, <span class="st">'siete.png'</span>, <span class="st">'tres.png'</span>, <span class="st">'uno.png'</span>]</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> image <span class="kw">in</span> images:</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    image_path <span class="op">=</span> <span class="st">"./pruebas/"</span> <span class="op">+</span> image</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    image <span class="op">=</span> Image.<span class="bu">open</span>(image_path).convert(<span class="st">"L"</span>).resize((<span class="dv">28</span>, <span class="dv">28</span>))</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    image_array <span class="op">=</span> np.array(image)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    inverted_image_array <span class="op">=</span> <span class="dv">255</span> <span class="op">-</span> image_array</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    image_input <span class="op">=</span> inverted_image_array.reshape(<span class="dv">1</span>, <span class="dv">28</span>, <span class="dv">28</span>, <span class="dv">1</span>)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> best_model.predict(image_input)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    predicted_class <span class="op">=</span> np.argmax(y_pred)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Clase predicha:"</span>, predicted_class)</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1/1 [==============================] - 0s 50ms/step
Clase predicha: 2
1/1 [==============================] - 0s 64ms/step
Clase predicha: 4
1/1 [==============================] - 0s 35ms/step
Clase predicha: 3
1/1 [==============================] - 0s 40ms/step
Clase predicha: 3
1/1 [==============================] - 0s 48ms/step
Clase predicha: 1</code></pre>
</div>
</div>
<p>Como se puede observar, las preducciones fueron bastante acertadas, con excepcion del numero 7, que como se ve en la matriz de confusion es uno de los que mas errores presenta. Asimiso la forma del dibujo realizado puede no ser la mas adecuada para el modelo, por lo que se podria mejorar el modelo con un mejor dibujo.</p>
</section>
</section>
</section>
<section id="ejercicio-2" class="level1">
<h1>Ejercicio # 2</h1>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.tsa <span class="im">as</span> tsa</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels <span class="im">as</span> sm</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.seasonal <span class="im">import</span> seasonal_decompose</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.stattools <span class="im">import</span> adfuller</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.stattools <span class="im">import</span> acf, pacf</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.models <span class="im">import</span> Sequential</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.layers <span class="im">import</span> Dense</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.layers <span class="im">import</span> LSTM</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>tf.random.set_seed(<span class="dv">123</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>cuantitativas <span class="op">=</span> [<span class="st">"Gasolina regular"</span>, <span class="st">"Gasolina superior"</span>, <span class="st">"Diesel alto azufre"</span>, <span class="st">"Gas licuado de petróleo"</span>, <span class="st">"Total"</span>]</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>años_dict <span class="op">=</span> {</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'00'</span>: <span class="st">'2000'</span>, <span class="st">'01'</span>: <span class="st">'2001'</span>, <span class="st">'02'</span>: <span class="st">'2002'</span>, <span class="st">'03'</span>: <span class="st">'2003'</span>, <span class="st">'04'</span>: <span class="st">'2004'</span>, <span class="st">'05'</span>: <span class="st">'2005'</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'06'</span>: <span class="st">'2006'</span>, <span class="st">'07'</span>: <span class="st">'2007'</span>, <span class="st">'08'</span>: <span class="st">'2008'</span>, <span class="st">'09'</span>: <span class="st">'2009'</span>, <span class="st">'10'</span>: <span class="st">'2010'</span>, <span class="st">'11'</span>: <span class="st">'2011'</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'12'</span>: <span class="st">'2012'</span>, <span class="st">'13'</span>: <span class="st">'2013'</span>, <span class="st">'14'</span>: <span class="st">'2014'</span>, <span class="st">'15'</span>: <span class="st">'2015'</span>, <span class="st">'16'</span>: <span class="st">'2016'</span>, <span class="st">'17'</span>: <span class="st">'2017'</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'18'</span>: <span class="st">'2018'</span>, <span class="st">'19'</span>: <span class="st">'2019'</span>, <span class="st">'20'</span>: <span class="st">'2020'</span>, <span class="st">'21'</span>: <span class="st">'2021'</span>, <span class="st">'22'</span>: <span class="st">'2022'</span>, <span class="st">'23'</span>: <span class="st">'2023'</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>meses_dict <span class="op">=</span> {</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ene'</span>: <span class="st">'01'</span>, <span class="st">'feb'</span>: <span class="st">'02'</span>, <span class="st">'mar'</span>: <span class="st">'03'</span>, <span class="st">'abr'</span>: <span class="st">'04'</span>, <span class="st">'may'</span>: <span class="st">'05'</span>, <span class="st">'jun'</span>: <span class="st">'06'</span>,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'jul'</span>: <span class="st">'07'</span>, <span class="st">'ago'</span>: <span class="st">'08'</span>, <span class="st">'sep'</span>: <span class="st">'09'</span>, <span class="st">'oct'</span>: <span class="st">'10'</span>, <span class="st">'nov'</span>: <span class="st">'11'</span>, <span class="st">'dic'</span>: <span class="st">'12'</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dateparse(fecha):</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    partes <span class="op">=</span> fecha.split(<span class="st">'-'</span>)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    partes[<span class="dv">0</span>] <span class="op">=</span> meses_dict[partes[<span class="dv">0</span>]]</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    partes[<span class="dv">1</span>] <span class="op">=</span> años_dict[partes[<span class="dv">1</span>]]</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.to_datetime(<span class="st">'-'</span>.join(partes), <span class="bu">format</span><span class="op">=</span><span class="st">'%m-%Y'</span>)</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>consumo <span class="op">=</span> pd.read_csv(<span class="st">'./Data/CONSUMO.csv'</span>, parse_dates<span class="op">=</span>[<span class="st">'Fecha'</span>], index_col<span class="op">=</span><span class="st">'Fecha'</span>,date_parser<span class="op">=</span>dateparse)</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">'</span><span class="ch">\n</span><span class="st"> Parsed Data:'</span>)</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>consumo.head()</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="co"># casteamos las variables a float</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> cuantitativas:</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>    consumo[col] <span class="op">=</span> consumo[col].<span class="bu">str</span>.replace(<span class="st">','</span>, <span class="st">''</span>).astype(<span class="bu">float</span>)</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>train_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(consumo) <span class="op">*</span> <span class="fl">0.7</span>)</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>train_consumo, test_consumo <span class="op">=</span> consumo[<span class="dv">0</span>:train_size], consumo[train_size:<span class="bu">len</span>(consumo)]</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>tr_consumo <span class="op">=</span> train_consumo.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Parsed Data:</code></pre>
</div>
</div>
<section id="modelo-1" class="level3">
<h3 class="anchored" data-anchor-id="modelo-1">Modelo 1</h3>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow <span class="im">import</span> keras</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> MinMaxScaler</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> MinMaxScaler()</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>train_scaled <span class="op">=</span> scaler.fit_transform(train_consumo)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>test_scaled <span class="op">=</span> scaler.transform(test_consumo)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_sequences_and_labels(data, seq_length):</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    sequences, labels <span class="op">=</span> [], []</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data) <span class="op">-</span> seq_length):</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>        seq <span class="op">=</span> data[i:i<span class="op">+</span>seq_length]</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> data[i<span class="op">+</span>seq_length]</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>        sequences.append(seq)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>        labels.append(label)</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array(sequences), np.array(labels)</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>seq_length <span class="op">=</span> <span class="dv">10</span>  </span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>X_train, y_train <span class="op">=</span> create_sequences_and_labels(train_scaled, seq_length)</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>X_test, y_test <span class="op">=</span> create_sequences_and_labels(test_scaled, seq_length)</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Construir el modelo LSTM 1</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>model1 <span class="op">=</span> keras.Sequential([</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>    keras.layers.LSTM(<span class="dv">50</span>, activation<span class="op">=</span><span class="st">'relu'</span>, input_shape<span class="op">=</span>(seq_length, X_train.shape[<span class="dv">2</span>])),</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>    keras.layers.Dense(<span class="dv">1</span>)</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>model1.<span class="bu">compile</span>(optimizer<span class="op">=</span><span class="st">'adam'</span>, loss<span class="op">=</span><span class="st">'mean_squared_error'</span>)</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>history1 <span class="op">=</span> model1.fit(X_train, y_train, epochs<span class="op">=</span><span class="dv">50</span>, batch_size<span class="op">=</span><span class="dv">32</span>, validation_data<span class="op">=</span>(X_test, y_test))</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>predictions1 <span class="op">=</span> model1.predict(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 1/50
6/6 [==============================] - 5s 127ms/step - loss: 0.1257 - val_loss: 0.8245
Epoch 2/50
6/6 [==============================] - 0s 32ms/step - loss: 0.0505 - val_loss: 0.7035
Epoch 3/50
6/6 [==============================] - 0s 34ms/step - loss: 0.0176 - val_loss: 1.1527
Epoch 4/50
6/6 [==============================] - 0s 39ms/step - loss: 0.0215 - val_loss: 1.2621
Epoch 5/50
6/6 [==============================] - 0s 71ms/step - loss: 0.0179 - val_loss: 0.9506
Epoch 6/50
6/6 [==============================] - 0s 32ms/step - loss: 0.0155 - val_loss: 0.8331
Epoch 7/50
6/6 [==============================] - 0s 48ms/step - loss: 0.0159 - val_loss: 0.8505
Epoch 8/50
6/6 [==============================] - 0s 50ms/step - loss: 0.0154 - val_loss: 0.9289
Epoch 9/50
6/6 [==============================] - 0s 40ms/step - loss: 0.0149 - val_loss: 1.0176
Epoch 10/50
6/6 [==============================] - 0s 38ms/step - loss: 0.0150 - val_loss: 1.0408
Epoch 11/50
6/6 [==============================] - 0s 33ms/step - loss: 0.0149 - val_loss: 0.9966
Epoch 12/50
6/6 [==============================] - 0s 38ms/step - loss: 0.0148 - val_loss: 0.9641
Epoch 13/50
6/6 [==============================] - 0s 34ms/step - loss: 0.0148 - val_loss: 1.0005
Epoch 14/50
6/6 [==============================] - 0s 34ms/step - loss: 0.0147 - val_loss: 1.0475
Epoch 15/50
6/6 [==============================] - 0s 38ms/step - loss: 0.0146 - val_loss: 1.0586
Epoch 16/50
6/6 [==============================] - 0s 34ms/step - loss: 0.0146 - val_loss: 1.0410
Epoch 17/50
6/6 [==============================] - 0s 42ms/step - loss: 0.0146 - val_loss: 1.1165
Epoch 18/50
6/6 [==============================] - 0s 38ms/step - loss: 0.0145 - val_loss: 1.0797
Epoch 19/50
6/6 [==============================] - 0s 38ms/step - loss: 0.0145 - val_loss: 1.0419
Epoch 20/50
6/6 [==============================] - 0s 40ms/step - loss: 0.0144 - val_loss: 1.0945
Epoch 21/50
6/6 [==============================] - 0s 37ms/step - loss: 0.0143 - val_loss: 1.0899
Epoch 22/50
6/6 [==============================] - 0s 39ms/step - loss: 0.0143 - val_loss: 1.0498
Epoch 23/50
6/6 [==============================] - 0s 44ms/step - loss: 0.0143 - val_loss: 1.0556
Epoch 24/50
6/6 [==============================] - 0s 40ms/step - loss: 0.0143 - val_loss: 1.0865
Epoch 25/50
6/6 [==============================] - 0s 39ms/step - loss: 0.0142 - val_loss: 1.0579
Epoch 26/50
6/6 [==============================] - 0s 36ms/step - loss: 0.0142 - val_loss: 1.0189
Epoch 27/50
6/6 [==============================] - 0s 43ms/step - loss: 0.0141 - val_loss: 1.0511
Epoch 28/50
6/6 [==============================] - 0s 38ms/step - loss: 0.0141 - val_loss: 1.0500
Epoch 29/50
6/6 [==============================] - 0s 39ms/step - loss: 0.0141 - val_loss: 1.0083
Epoch 30/50
6/6 [==============================] - 0s 35ms/step - loss: 0.0140 - val_loss: 1.0183
Epoch 31/50
6/6 [==============================] - 0s 41ms/step - loss: 0.0140 - val_loss: 1.0242
Epoch 32/50
6/6 [==============================] - 0s 38ms/step - loss: 0.0140 - val_loss: 1.0023
Epoch 33/50
6/6 [==============================] - 0s 37ms/step - loss: 0.0140 - val_loss: 0.9733
Epoch 34/50
6/6 [==============================] - 0s 40ms/step - loss: 0.0139 - val_loss: 1.0325
Epoch 35/50
6/6 [==============================] - 0s 38ms/step - loss: 0.0140 - val_loss: 1.0093
Epoch 36/50
6/6 [==============================] - 0s 36ms/step - loss: 0.0139 - val_loss: 0.9001
Epoch 37/50
6/6 [==============================] - 0s 42ms/step - loss: 0.0139 - val_loss: 0.9213
Epoch 38/50
6/6 [==============================] - 0s 40ms/step - loss: 0.0138 - val_loss: 0.9094
Epoch 39/50
6/6 [==============================] - 0s 42ms/step - loss: 0.0139 - val_loss: 0.8612
Epoch 40/50
6/6 [==============================] - 0s 41ms/step - loss: 0.0138 - val_loss: 0.8971
Epoch 41/50
6/6 [==============================] - 0s 38ms/step - loss: 0.0137 - val_loss: 0.8456
Epoch 42/50
6/6 [==============================] - 0s 46ms/step - loss: 0.0137 - val_loss: 0.8214
Epoch 43/50
6/6 [==============================] - 0s 63ms/step - loss: 0.0138 - val_loss: 0.8269
Epoch 44/50
6/6 [==============================] - 0s 38ms/step - loss: 0.0138 - val_loss: 0.8241
Epoch 45/50
6/6 [==============================] - 0s 40ms/step - loss: 0.0138 - val_loss: 0.7807
Epoch 46/50
6/6 [==============================] - 0s 45ms/step - loss: 0.0136 - val_loss: 0.8271
Epoch 47/50
6/6 [==============================] - 0s 43ms/step - loss: 0.0137 - val_loss: 0.7474
Epoch 48/50
6/6 [==============================] - 0s 39ms/step - loss: 0.0137 - val_loss: 0.7320
Epoch 49/50
6/6 [==============================] - 0s 55ms/step - loss: 0.0136 - val_loss: 0.7560
Epoch 50/50
6/6 [==============================] - 0s 58ms/step - loss: 0.0136 - val_loss: 0.7331
3/3 [==============================] - 1s 11ms/step</code></pre>
</div>
</div>
</section>
<section id="modelo-2" class="level3">
<h3 class="anchored" data-anchor-id="modelo-2">Modelo 2</h3>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Construir el modelo LSTM 2</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>model2 <span class="op">=</span> keras.Sequential([</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    keras.layers.LSTM(<span class="dv">100</span>, activation<span class="op">=</span><span class="st">'tanh'</span>, return_sequences<span class="op">=</span><span class="va">True</span>, input_shape<span class="op">=</span>(seq_length, X_train.shape[<span class="dv">2</span>])),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    keras.layers.LSTM(<span class="dv">50</span>, activation<span class="op">=</span><span class="st">'tanh'</span>),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    keras.layers.Dense(<span class="dv">1</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>model2.<span class="bu">compile</span>(optimizer<span class="op">=</span><span class="st">'adam'</span>, loss<span class="op">=</span><span class="st">'mean_squared_error'</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>history2 <span class="op">=</span> model2.fit(X_train, y_train, epochs<span class="op">=</span><span class="dv">50</span>, batch_size<span class="op">=</span><span class="dv">32</span>, validation_data<span class="op">=</span>(X_test, y_test))</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>predictions2 <span class="op">=</span> model2.predict(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 1/50
6/6 [==============================] - 12s 472ms/step - loss: 0.0787 - val_loss: 0.6947
Epoch 2/50
6/6 [==============================] - 0s 50ms/step - loss: 0.0353 - val_loss: 0.6913
Epoch 3/50
6/6 [==============================] - 0s 51ms/step - loss: 0.0200 - val_loss: 0.7577
Epoch 4/50
6/6 [==============================] - 0s 51ms/step - loss: 0.0211 - val_loss: 0.6853
Epoch 5/50
6/6 [==============================] - 0s 52ms/step - loss: 0.0160 - val_loss: 0.6874
Epoch 6/50
6/6 [==============================] - 0s 42ms/step - loss: 0.0164 - val_loss: 0.6793
Epoch 7/50
6/6 [==============================] - 0s 40ms/step - loss: 0.0154 - val_loss: 0.6795
Epoch 8/50
6/6 [==============================] - 0s 40ms/step - loss: 0.0151 - val_loss: 0.7085
Epoch 9/50
6/6 [==============================] - 0s 42ms/step - loss: 0.0149 - val_loss: 0.7317
Epoch 10/50
6/6 [==============================] - 0s 43ms/step - loss: 0.0146 - val_loss: 0.7349
Epoch 11/50
6/6 [==============================] - 0s 40ms/step - loss: 0.0148 - val_loss: 0.7754
Epoch 12/50
6/6 [==============================] - 0s 43ms/step - loss: 0.0146 - val_loss: 0.7984
Epoch 13/50
6/6 [==============================] - 0s 45ms/step - loss: 0.0145 - val_loss: 0.8319
Epoch 14/50
6/6 [==============================] - 0s 41ms/step - loss: 0.0144 - val_loss: 0.8390
Epoch 15/50
6/6 [==============================] - 0s 39ms/step - loss: 0.0144 - val_loss: 0.8638
Epoch 16/50
6/6 [==============================] - 0s 39ms/step - loss: 0.0143 - val_loss: 0.8995
Epoch 17/50
6/6 [==============================] - 0s 40ms/step - loss: 0.0145 - val_loss: 0.9430
Epoch 18/50
6/6 [==============================] - 0s 39ms/step - loss: 0.0143 - val_loss: 0.9673
Epoch 19/50
6/6 [==============================] - 0s 44ms/step - loss: 0.0142 - val_loss: 1.0110
Epoch 20/50
6/6 [==============================] - 0s 43ms/step - loss: 0.0142 - val_loss: 1.0511
Epoch 21/50
6/6 [==============================] - 0s 48ms/step - loss: 0.0141 - val_loss: 1.1076
Epoch 22/50
6/6 [==============================] - 0s 43ms/step - loss: 0.0140 - val_loss: 1.1474
Epoch 23/50
6/6 [==============================] - 0s 49ms/step - loss: 0.0140 - val_loss: 1.1968
Epoch 24/50
6/6 [==============================] - 0s 44ms/step - loss: 0.0140 - val_loss: 1.1879
Epoch 25/50
6/6 [==============================] - 0s 40ms/step - loss: 0.0141 - val_loss: 1.2521
Epoch 26/50
6/6 [==============================] - 0s 40ms/step - loss: 0.0139 - val_loss: 1.2396
Epoch 27/50
6/6 [==============================] - 0s 40ms/step - loss: 0.0139 - val_loss: 1.3034
Epoch 28/50
6/6 [==============================] - 0s 40ms/step - loss: 0.0140 - val_loss: 1.3051
Epoch 29/50
6/6 [==============================] - 0s 38ms/step - loss: 0.0138 - val_loss: 1.3702
Epoch 30/50
6/6 [==============================] - 0s 40ms/step - loss: 0.0139 - val_loss: 1.3866
Epoch 31/50
6/6 [==============================] - 0s 41ms/step - loss: 0.0141 - val_loss: 1.3105
Epoch 32/50
6/6 [==============================] - 0s 52ms/step - loss: 0.0141 - val_loss: 1.3240
Epoch 33/50
6/6 [==============================] - 0s 50ms/step - loss: 0.0140 - val_loss: 1.3211
Epoch 34/50
6/6 [==============================] - 0s 41ms/step - loss: 0.0139 - val_loss: 1.2931
Epoch 35/50
6/6 [==============================] - 1s 110ms/step - loss: 0.0138 - val_loss: 1.2822
Epoch 36/50
6/6 [==============================] - 0s 57ms/step - loss: 0.0139 - val_loss: 1.3159
Epoch 37/50
6/6 [==============================] - 0s 65ms/step - loss: 0.0141 - val_loss: 1.2451
Epoch 38/50
6/6 [==============================] - 0s 66ms/step - loss: 0.0140 - val_loss: 1.3201
Epoch 39/50
6/6 [==============================] - 0s 58ms/step - loss: 0.0140 - val_loss: 1.2249
Epoch 40/50
6/6 [==============================] - 0s 76ms/step - loss: 0.0141 - val_loss: 1.2086
Epoch 41/50
6/6 [==============================] - 0s 76ms/step - loss: 0.0138 - val_loss: 1.2274
Epoch 42/50
6/6 [==============================] - 0s 61ms/step - loss: 0.0139 - val_loss: 1.1776
Epoch 43/50
6/6 [==============================] - 0s 60ms/step - loss: 0.0141 - val_loss: 1.2701
Epoch 44/50
6/6 [==============================] - 0s 61ms/step - loss: 0.0138 - val_loss: 1.1508
Epoch 45/50
6/6 [==============================] - 0s 72ms/step - loss: 0.0138 - val_loss: 1.2374
Epoch 46/50
6/6 [==============================] - 0s 59ms/step - loss: 0.0141 - val_loss: 1.1008
Epoch 47/50
6/6 [==============================] - 0s 60ms/step - loss: 0.0137 - val_loss: 1.1787
Epoch 48/50
6/6 [==============================] - 0s 70ms/step - loss: 0.0138 - val_loss: 1.1495
Epoch 49/50
6/6 [==============================] - 0s 57ms/step - loss: 0.0135 - val_loss: 1.1986
Epoch 50/50
6/6 [==============================] - 0s 63ms/step - loss: 0.0136 - val_loss: 1.1482
3/3 [==============================] - 2s 9ms/step</code></pre>
</div>
</div>
</section>
<section id="predicciones-con-ambos-modelos" class="level3">
<h3 class="anchored" data-anchor-id="predicciones-con-ambos-modelos">Predicciones con ambos modelos</h3>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> MinMaxScaler</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>scaler_feature <span class="op">=</span> MinMaxScaler()</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>scaler_feature.fit(train_consumo[[<span class="st">'Gasolina regular'</span>]])  </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>predictions1_original <span class="op">=</span> scaler_feature.inverse_transform(predictions1)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>predictions2_original <span class="op">=</span> scaler_feature.inverse_transform(predictions2)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>y_test_original <span class="op">=</span> scaler_feature.inverse_transform(y_test)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>num_pred_samples <span class="op">=</span> <span class="bu">len</span>(y_test_original) <span class="op">-</span> seq_length <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>indices <span class="op">=</span> <span class="bu">range</span>(seq_length, <span class="bu">len</span>(y_test_original) <span class="op">+</span> <span class="dv">1</span>) </span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>predictions1_original <span class="op">=</span> predictions1_original.flatten()[:num_pred_samples]</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>predictions2_original <span class="op">=</span> predictions2_original.flatten()[:num_pred_samples]</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>y_test_original <span class="op">=</span> y_test_original.flatten()[:num_pred_samples]</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>indices <span class="op">=</span> <span class="bu">range</span>(seq_length, <span class="bu">len</span>(y_test_original) <span class="op">+</span> seq_length)</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>plt.plot(indices, y_test_original, label<span class="op">=</span><span class="st">'Datos reales'</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>plt.plot(indices, predictions1_original, label<span class="op">=</span><span class="st">'Predicciones Modelo 1'</span>, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Índice de tiempo'</span>)</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Valor'</span>)</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Predicciones del Modelo 1 vs Datos reales'</span>)</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>plt.plot(indices, y_test_original, label<span class="op">=</span><span class="st">'Datos reales'</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>plt.plot(indices, predictions2_original, label<span class="op">=</span><span class="st">'Predicciones Modelo 2'</span>, color<span class="op">=</span><span class="st">'green'</span>)</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Índice de tiempo'</span>)</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Valor'</span>)</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Predicciones del Modelo 2 vs Datos reales'</span>)</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lab3_files/figure-html/cell-17-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="lab3_files/figure-html/cell-17-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Al analizar las predicciones de los modelos usando LSTM, se puede observar en el gráfico que el modelo que mejor se apega a los valores reales es el modelo 1 ya que sigue una tendencia mas parecida y el modelo 2 se aleja mas a los valores reales.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lab3_files/figure-html/aac132e7-1-image.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">image.png</figcaption><p></p>
</figure>
</div>
<p>Como se puede observar en la grafica anterior que del modelo realizado en el labraboratorio 2, aunque este si era bueno para predecir, tenia resultados constantes y pocas variaciones, en comparacion al modelo LSTM que si muestra una tendencia mas realista y con variaciones mas notorias, como se puede observar en su grafica, algo que indica que este modelo es mejor para predecir el comportamiento del consumo de gasolina regular con respecto al tiempo.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>